---
title: "Electrophysiological measures of visual suppression"
author: "Daniel H. Baker & Alex R. Wade"
date: "`r Sys.Date()`"
output:
  bookdown::pdf_document2:
    fig_caption: yes 
    toc: false   
    keep_tex: true
  html_document:
    df_print: paged
  pdf_document: default
bibliography: bibliography.bib
csl: elife.csl
# biblio-style: apalike
---

```{r setup, include=FALSE}

runcode <- 0  # this flag chooses whether to run the underlying analysis code (1), or just load in the figures from the last time this was run (0)

# reasonably compact code to check which packages are installed, install the missing ones, and activate all
packagelist <- c('knitr','neldermead','tictoc','grImport','tiff','pals','bmp')
missingpackages <- packagelist[!packagelist %in% installed.packages()[,1]]
if (length(missingpackages)>0){install.packages(missingpackages)}
toinstall <- packagelist[which(!packagelist %in% (.packages()))]
invisible(lapply(toinstall,library,character.only=TRUE))

addalpha <- function(col, alpha=1){apply(sapply(col, col2rgb)/255, 2, function(x) rgb(x[1], x[2], x[3], alpha=alpha))}
alphalev <- 0.2
colourlist <- c("black","cornflowerblue","olivedrab3","sandybrown","mediumpurple2")

knitr::opts_chunk$set(echo = TRUE)

```

# Abstract



# Introduction

Suppression is a fundamental component of the nervous system, and is critically important for moderating neural firing. Without suppression, neural activity would be too metabolically expensive, and uncontrolled excitation would lead to seizures. In the visual system, neurons responsive to a spatially localised stimulus of a given orientation are suppressed by nearby neurons that differ in their tuning. This tuning might involve different orientations (cross-orientation suppression), different spatial locations (lateral, or surround suppression), and different eye-of-origin (interocular suppression).

Several studies have demonstrated that these different types of suppression occur at different stages in the early visual pathway, and therefore have different characteristics. @Baker2007 @Petrov2005 @Li2005

In addition, there is evidence that suppression builds up at successive stages of cortical processing, beyond primary visual cortex, and is stronger at later levels in the visual hierarchy.

An important distinction concerns whether a suppressive effect modulates the contrast gain or the response gain of a neuron. Changes in contrast gain shift the stimulus-response curve (the contrast response function) laterally, whereas changes in response gain scale the function vertically (see examples in Figure \@ref(fig:stimfig)c). These different patterns may be indicative of specific neurophysiological underpinnings for an effect. Additionally, both processes might occur at successive stages of processing.

```{r include=FALSE}

# build figure 1
if (runcode==1){
  
contrastsfinedB <- 0:40
contrastsfineC <- 10^(contrastsfinedB/20)

postscript('temp/CGvsRGexample.ps', horizontal = FALSE, onefile = FALSE, paper = "special", height = 5.5, width = 5.5)

plotlims <- c(0,42,0,1.2) 
ticklocsx <- seq(0,42,6)    # locations of tick marks on x axis
ticklocsy <- seq(0,1.2,0.2)    # locations of tick marks on y axis
ticklabelsx <- c(2^(0:6),'')       # set labels for x ticks
ticklabelsy <- ticklocsy    # set labels for y ticks
par(pty="s")  # make axis square
plot(x=NULL,y=NULL,axes=FALSE, ann=FALSE, xlim=plotlims[1:2], ylim=plotlims[3:4]) 
axis(1, at=ticklocsx, tck=0.01, lab=F, lwd=2)     # plot tick marks (no labels)
axis(2, at=ticklocsy, tck=0.01, lab=F, lwd=2)
mtext(text = ticklabelsx, side = 1, at=ticklocsx)     # add the tick labels
mtext(text = ticklabelsy, side = 2, at=ticklocsy, line=0.2, las=1)  
title(xlab="Target contrast (%)", col.lab=rgb(0,0,0), line=1.2, cex.lab=1.5)  
title(ylab="Response", col.lab=rgb(0,0,0), line=1.5, cex.lab=1.5)

p <- c(2,10,1)
pred <- (contrastsfineC^p[1])/(p[2]^(p[1]*p[3]) + contrastsfineC^(p[1]*p[3]))
lines(contrastsfinedB,pred,col='black',lwd=4)

pred <- (contrastsfineC^p[1])/(5*p[2]^(p[1]*p[3]) + contrastsfineC^(p[1]*p[3]))
lines(contrastsfinedB,pred,col='black',lwd=4,lty=2)

pred <- 0.7*(contrastsfineC^p[1])/(p[2]^(p[1]*p[3]) + contrastsfineC^(p[1]*p[3]))
lines(contrastsfinedB,pred,col='black',lwd=4,lty=3)

legend(0, 1.2, c("Target only","Contrast gain","Response gain"), cex=1, col='black',lty=1:3, lwd=4, box.lwd=2)

dev.off()



postscript('temp/saturationplot.ps', horizontal = FALSE, onefile = FALSE, paper = "special", height = 5.5, width = 5.5)

par(pty="s")  # make axis square
plot(x=NULL,y=NULL,axes=FALSE, ann=FALSE, xlim=plotlims[1:2], ylim=plotlims[3:4])   
axis(1, at=ticklocsx, tck=0.01, lab=F, lwd=2)     # plot tick marks (no labels)
axis(2, at=ticklocsy, tck=0.01, lab=F, lwd=2)
mtext(text = ticklabelsx, side = 1, at=ticklocsx)     # add the tick labels
mtext(text = ticklabelsy, side = 2, at=ticklocsy, line=0.2, las=1)
title(xlab="Target contrast (%)", col.lab=rgb(0,0,0), line=1.2, cex.lab=1.5)
title(ylab="Response", col.lab=rgb(0,0,0), line=1.5, cex.lab=1.5)

p <- c(2,10,1.1)
pred <- (contrastsfineC^(p[1]*p[3]))/(p[2]^p[1] + contrastsfineC^p[1])
pred <- pred/pred[41]
lines(contrastsfinedB,pred,col='black',lwd=4)

p <- c(2,10,1)
pred <- (contrastsfineC^(p[1]*p[3]))/(p[2]^p[1] + contrastsfineC^p[1])
pred <- pred/pred[41]
lines(contrastsfinedB,pred,col='black',lwd=4,lty=2)

p <- c(2,10,0.9)
pred <- (contrastsfineC^(p[1]*p[3]))/(p[2]^p[1] + contrastsfineC^p[1])
pred <- pred/pred[41]
lines(contrastsfinedB,pred,col='black',lwd=4,lty=3)

legend(0, 1.2, c("Accelerating","Saturated","Super-saturating"), cex=1, col='black',lty=1:3, lwd=4, box.lwd=2)

dev.off()

stim1 <- read.bmp('stimuli/blank.bmp')/255
stim2 <- read.bmp('stimuli/targetonly.bmp')/255
stim3 <- read.bmp('stimuli/maskonly.bmp')/255
stim4 <- read.bmp('stimuli/plaid.bmp')/255
stim5 <- read.bmp('stimuli/isosurround.bmp')/255
stim6 <- read.bmp('stimuli/orthsurround.bmp')/255


  pdf('figures/stimfig.pdf', bg="transparent", height = 6, width = 9)
  par(mar=c(0.05,0.05,0.05,0.05))
  plot(x=NULL,y=NULL,axes=FALSE, ann=FALSE, xlim=c(0,1), ylim=c(0,1))

      aspratio <- 6/9
      imwidth <- 0.25
      
      xstart <- 0.175
      ystart <- 0.7
      rasterImage(cbind(stim2,stim1),xstart,ystart,xstart+2*imwidth*aspratio,ystart+imwidth)

            xstart <- 0.0
      ystart <- 0.35
      rasterImage(cbind(stim4,stim1),xstart,ystart,xstart+2*imwidth*aspratio,ystart+imwidth)
      
            xstart <- 0.35
      ystart <- 0.35
      rasterImage(cbind(stim2,stim3),xstart,ystart,xstart+2*imwidth*aspratio,ystart+imwidth)
      
            xstart <- 0.0
      ystart <- 0
      rasterImage(cbind(stim5,stim1),xstart,ystart,xstart+2*imwidth*aspratio,ystart+imwidth)
      
            xstart <- 0.35
      ystart <- 0
      rasterImage(cbind(stim6,stim1),xstart,ystart,xstart+2*imwidth*aspratio,ystart+imwidth)
      
      PostScriptTrace(paste('temp/saturationplot.ps',sep=''))
      e1 <- readPicture('saturationplot.ps.xml')
      PostScriptTrace(paste('temp/CGvsRGexample.ps',sep=''))
      e2 <- readPicture('CGvsRGexample.ps.xml')
      
      grid.picture(e1,x=5/6,y=0.75,width=1,height=0.45)      
      grid.picture(e2,x=5/6,y=0.25,width=1,height=0.45)
      
      text(-0.05,1.01,'(a)',pos=4,cex=2)
      text(0.675,1.01,'(b)',pos=4,cex=2)
      text(0.675,0.48,'(c)',pos=4,cex=2)
      
      text(0.34,0.98,'Target only',adj=0.5,cex=1.5)
      text(0.168,0.63,'Monocular mask',adj=0.5,cex=1.5)
      text(0.52,0.63,'Dichoptic mask',adj=0.5,cex=1.5)
      text(0.166,0.28,'Aligned surround',adj=0.5,cex=1.5)
      text(0.52,0.28,'Orthogonal surround',adj=0.5,cex=1.5)
      
      text(0.26,0.93,'Left eye',adj=0.5,cex=1)
      text(0.42,0.93,'Right eye',adj=0.5,cex=1)
      text(0.086,0.58,'Left eye',adj=0.5,cex=1)
      text(0.248,0.58,'Right eye',adj=0.5,cex=1)
      text(0.438,0.58,'Left eye',adj=0.5,cex=1)
      text(0.602,0.58,'Right eye',adj=0.5,cex=1)
      text(0.086,0.23,'Left eye',adj=0.5,cex=1)
      text(0.248,0.23,'Right eye',adj=0.5,cex=1)
      text(0.438,0.23,'Left eye',adj=0.5,cex=1)
      text(0.602,0.23,'Right eye',adj=0.5,cex=1)
      
      points(0.25,0.982,pch=21,lwd=3,cex=2.5,bg=colourlist[1])
      points(0.04,0.63,pch=22,lwd=3,cex=2.5,bg=colourlist[2])
      points(0.4,0.63,pch=23,lwd=3,cex=2.5,bg=colourlist[3])
      points(0.03,0.28,pch=24,lwd=3,cex=2.5,bg=colourlist[4])
      points(0.36,0.28,pch=25,lwd=3,cex=2.5,bg=colourlist[5])
      
  dev.off()
  
file.remove(c('temp/saturationplot.ps','temp/CGvsRGexample.ps'))
file.remove(c('saturationplot.ps.xml','CGvsRGexample.ps.xml'))

}

```

```{r stimfig, fig.cap="Example stimuli and illustration of contrast response functions.", fig.align="center", echo=FALSE, fig.width=9, fig.height=6}

knitr::include_graphics('figures/stimfig.pdf')

```

In this study, we measured four types of suppression in human participants using a steady-state evoked potential (SSVEP) technique. Target stimuli flickered at a known frequency (5Hz), and frequency-locked responses were measured using electroencephalography (EEG). Note that the SSVEP technique records ensemble activity of populations of neurons that are responsive to the target stimulus. Our primary motivation was to compare the suppressive effects from different mask types (monocular, dichoptic, and two types of surround mask), to determine whether they are best described as contrast or response gain modulation, and to explore how suppression changes at successive stages of processing. We repeated the experiment at two different mask contrasts, and analyse the data using a Bayesian modelling approach.

# Methods

## Participants

Twelve participants completed each version of the experiment (3 participants completed both experiments, the remaining 9 were unique to each experiment). All participants had normal or corrected-to-normal vision, and no known visual abnormalities. All participants provided written informed consent.

## Apparatus and stimuli

Stimuli were presented using a ViewPixx 3D display, driven by a Mac Pro computer. The display updated at 120 Hz, and we interleaved frames intended for the left and right eyes (60 Hz refresh rate per eye). The display update was synchronised with a set of NVidia 3D pro active shutter glasses using an infra-red signal. The display had a resolution of 1920 $\times$ 1280 pixels, and was viewed from a distance of 57cm, at which one degree of visual angle had a diameter of 36 pixels. The display was run in the high bit-depth monochrome M16 mode, which provided 16 bits of greyscale resolution. The display was gamma corrected using a Minolta LS110 photometer and had a maximum luminance of 102 $cd/m^2$.

All stimuli were patches of sinusoidal grating with a spatial frequency of 1 cycle per degree. Target stimuli were randomly oriented on each trial, and windowed by a raised cosine envelope with a width of 2 degrees. There were 20 targets arranged in a symmetrical pattern around a central fixation marker, as shown in Figure \@ref(fig:stimfig). The target eccentricities were 3.6, 7.1, 8.5 and 10.7 degrees from the central fixation. Stimuli were placed at 90 degree intervals at each radius, or in 45 degree intervals at the largest eccentricity. All target stimuli flickered sinusoidally at 5Hz (on-off flicker), between 0% contrast and their nominal Michelson contrast, which was one of six values (0, 6, 12, 24, 48 and 96%). Percentage Michelson contrast is defined as $100\frac{L_{max}-L_{min}}{L_{max}+L_{min}}$, where _L_ is luminance. Targets were shown to one eye only, which was chosen randomly on each trial. A binocular fixation marker was created from a cluster of overlaid squares (each 13 arc min wide) with random grey levels, designed to aid binocular fusion. Similar markers were also presented in the four corners of the stimulus region, at a distance of 15.7 degrees from the display centre.

We measured target responses with no mask, and also with four categories of mask stimulus. Monocular masks were shown to the same eye as the targets and in the same locations, but had orthogonal orientation. Dichoptic masks were the same, but shown to the non-target eye. Aligned surround masks were large (28 degrees) grating patches with the same orientation as the target, and with holes surrounding each target element (and the fixation marker). The holes were 4 degrees in diameter, meaning the gap between target and mask was 1 degree. Orthogonal surrounds were the same, but were oriented at 90 degrees relative to the targets. There were two principal mask contrasts that were used in the two versions of the experiment: 12% and 24%. We also tested several additional mask contrasts (6, 48 and 96% contrast) for a single target contrast of 24%. The masks drifted at a speed of 6 deg/sec so that the phase alignment between mask and target changed over time. Note that drifting gratings do not produce a steady-state signal, so we did not record responses to the mask stimuli. Also, for some of the monocular mask conditions, the stimulus contrast was reduced from 96% to 68% to avoid clipping artifacts caused by overlaying the target and mask.

EEG activity was recorded using a 64-channel ANT Neuroscan system sampling at 1 kHz. Participants wore Waveguard caps, with electrodes organised according to the 10/20 system. The ground was located at position _AFz_, and each channel was referenced to the whole-head average. Electrode impedance was maintained at or below $5k\Omega$ throughout the experiment. Digital parallel triggers were sent from the ViewPixx display to the EEG amplifier, and recorded the onset of each trial on the EEG trace. Data were amplified, digitised, and saved to disc for offline analysis.

## Procedure

## Data analysis and modelling



## Data and script availability

All data and scripts are publicly available at: 

# Results



# Discussion

# Acknowledgements

Supported by the Royal Society (grant number RG130121 to DHB).

# References




